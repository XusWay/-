<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>文本编辑器 2558 徐泽伟</title>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--bg:#000;--sf:rgba(28,28,30,0.85);--tx:#fff;--sub:#86868b;--bd:rgba(255,255,255,0.12);--ac:#0a84ff;--er:#ff453a}
*{box-sizing:border-box;outline:0;-webkit-tap-highlight-color:transparent}
body{margin:0;background:var(--bg);color:var(--tx);font-family:-apple-system,sans-serif;height:100vh;display:flex;flex-direction:column;overflow:hidden}
.header{height:50px;display:flex;justify-content:space-between;align-items:center;padding:0 16px;background:var(--sf);border-bottom:0.5px solid var(--bd);backdrop-filter:blur(20px) saturate(180%);z-index:10}
.hl,.hr{display:flex;align-items:center;gap:12px}
.dots{display:flex;gap:8px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.r{background:#ff5f57}.dot.y{background:#febc2e}.dot.g{background:#28c840;cursor:pointer}
.st{font-size:12px;color:var(--sub);font-variant-numeric:tabular-nums}
.bt{padding:6px 12px;color:var(--sub);border-radius:6px;font-size:13px;background:rgba(255,255,255,0.05);cursor:pointer}
.bt.er{color:var(--er)}
.main{flex:1;position:relative;overflow:hidden}
.gl{position:absolute;inset:0;pointer-events:none;opacity:0;background-size:24px 24px;background-image:linear-gradient(to right,#222 1px,transparent 1px),linear-gradient(to bottom,#222 1px,transparent 1px)}
#ed{width:100%;height:100%;font-size:17px;line-height:1.75;padding:24px;resize:none;display:block;border:0;background:0 0;color:inherit;caret-color:var(--ac)}
.dock{background:var(--sf);border-top:0.5px solid var(--bd);backdrop-filter:blur(25px);padding-bottom:env(safe-area-inset-bottom)}
.pl{height:0;overflow:hidden;transition:height .3s cubic-bezier(0.16,1,0.3,1)}
.pl.on{height:auto;max-height:45vh;overflow-y:auto;border-bottom:0.5px solid var(--bd)}
.pc{padding:16px;display:flex;flex-direction:column;gap:16px}
.rw{display:flex;align-items:center;justify-content:space-between;gap:12px}
.ig{background:rgba(0,0,0,0.3);border:0.5px solid var(--bd);border-radius:8px;display:flex;flex:1;padding:2px}
.ig input{flex:1;padding:0 8px;font-size:14px;height:32px;background:0 0;border:0;color:#fff}
.ig button{width:32px;background:0 0;border:0;border-left:0.5px solid var(--bd);color:var(--sub)}
.gr{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
.tb{background:rgba(255,255,255,0.08);color:#ccc;border:0;padding:12px 0;border-radius:10px;font-size:13px}
.tb.w{background:var(--ac);color:#fff;grid-column:span 2;font-weight:600}
.bar{height:60px;display:flex;align-items:center;padding:0 10px;gap:8px}
.ic{flex:1;height:44px;background:rgba(255,255,255,0.08);color:#fff;border-radius:10px;border:0;font-size:18px}
.ic.m{background:rgba(10,132,255,0.2);color:var(--ac);flex:0 0 50px}
.mo{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);z-index:100;display:none;align-items:center;justify-content:center}
.mb{background:#1c1c1e;width:90%;max-width:360px;border-radius:16px;border:0.5px solid var(--bd);overflow:hidden}
.mh{padding:16px;border-bottom:0.5px solid var(--bd);display:flex;justify-content:space-between}
.ts{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(40,40,40,0.9);padding:16px 32px;border-radius:40px;color:#fff;opacity:0;pointer-events:none;transition:all .2s;z-index:200}
.ts.on{opacity:1}
#tp{position:fixed;inset:0;background:#000;z-index:150;display:none;flex-direction:column}
.ph{padding:16px;display:flex;justify-content:flex-end;gap:10px;border-bottom:1px solid #333}
.p-cnt{flex:1;overflow:auto;padding:20px;display:flex;justify-content:center}
.p-tab{border-collapse:collapse;color:#fff;width:100%}
.p-tab td{border:1px solid #444;padding:10px}
</style>
</head>
<body>
<div class="header">
    <div class="hl">
        <div class="dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g" id="b-ss"></div></div>
        <div id="st" class="st">0字 / 1行</div>
    </div>
    <div class="hr"><div class="bt" id="b-py">赞赏</div><div class="bt er" id="b-cl">清空</div></div>
</div>
<div class="main"><div id="gl" class="gl"></div><textarea id="ed" placeholder="徐泽伟 倾情打造" spellcheck="false"></textarea></div>
<div class="dock">
    <div class="pl" id="pl"><div class="pc">
        <div class="rw"><span style="font-size:13px;color:var(--sub)">字号</span><input type="range" id="fs" min="12" max="36" value="17"><button class="tb" style="width:70px" id="b-tg">网格</button></div>
        <div class="rw">
            <div class="ig"><input id="fi" placeholder="查找"><button id="f-n">↓</button><button id="f-p">↑</button></div>
            <div class="ig"><input id="ri" placeholder="替换"><button id="r-o">换</button><button id="r-a">全</button></div>
        </div>
        <div class="gr">
            <button class="tb" data-a="fm">排版</button><button class="tb" data-a="dd">去重</button><button class="tb" data-a="mg">合并</button><button class="tb" data-a="ln">行号</button>
            <button class="tb" data-a="cc">大小写</button><button class="tb" data-a="rv">翻转</button><button class="tb" data-a="sr">排序</button><button class="tb" data-a="et">提取</button>
            <button class="tb w" data-a="tb">生成表格</button><button class="tb w" data-a="ex">导出文件</button>
        </div>
    </div></div>
    <div class="bar">
        <button class="ic" data-c="cp">复制</button><button class="ic" data-c="ml">←</button><button class="ic" data-c="mr">→</button>
        <button class="ic" data-c="un">↶</button><button class="ic" data-c="re">↷</button><button class="ic" data-c="ps">粘贴</button>
        <button class="ic m" id="b-m">▼</button>
    </div>
</div>
<div class="mo" id="mw"><div class="mb"><div class="mh"><span id="mt"></span><span style="cursor:pointer" id="mc">✕</span></div><div id="m-body"></div></div></div>
<div id="tp"><div class="ph"><button class="bt" id="s-ti">存图</button><button class="bt" id="s-th">网页</button><button class="bt er" id="c-tp">关闭</button></div><div class="p-cnt" id="tc"></div></div>
<div id="toast" class="ts"></div>
<script>
class Editor{
    constructor(){
        this.el=document.getElementById('ed');
        this.st=document.getElementById('st');
        this.hi=[];this.idx=-1;this.ti=null;
        this.init();
    }
    init(){
        this.el.value=localStorage.getItem('x_t')||'';
        const sz=localStorage.getItem('x_s')||'17';
        this.el.style.fontSize=sz+'px';
        document.getElementById('fs').value=sz;
        this.up();this.sv(true);this.bind();
    }
    bind(){
        this.el.oninput=()=>{this.up();clearTimeout(this.ti);this.ti=setTimeout(()=>this.sv(),500)};
        document.getElementById('b-cl').onclick=()=>{if(confirm('清空？')){this.el.value='';this.sv();this.up()}};
        document.getElementById('b-ss').onclick=()=>this.ss();
        document.getElementById('b-py').onclick=()=>this.mod('赞赏','<div style="padding:30px;text-align:center"><img src="1000003802.png" style="max-width:100%"></div>');
        document.getElementById('b-m').onclick=()=>document.getElementById('pl').classList.toggle('on');
        document.getElementById('fs').oninput=(e)=>{this.el.style.fontSize=e.target.value+'px';localStorage.setItem('x_s',e.target.value)};
        document.getElementById('b-tg').onclick=()=>document.getElementById('gl').style.opacity=document.getElementById('gl').style.opacity=='1'?'0':'1';
        document.getElementById('f-n').onclick=()=>this.find(1);
        document.getElementById('f-p').onclick=()=>this.find(-1);
        document.getElementById('r-o').onclick=()=>this.rep(0);
        document.getElementById('r-a').onclick=()=>this.rep(1);
        document.querySelector('.gr').onclick=(e)=>{const a=e.target.dataset.a;if(a)this.act(a)};
        document.querySelector('.bar').onclick=(e)=>{const c=e.target.dataset.c;if(c)this.cmd(c)};
        document.getElementById('mc').onclick=()=>document.getElementById('mw').style.display='none';
        document.getElementById('c-tp').onclick=()=>document.getElementById('tp').style.display='none';
    }
    up(){const v=this.el.value;this.st.innerText=`${v.length}字 / ${v?v.split('\n').length:1}行`}
    sv(f){
        const v=this.el.value;localStorage.setItem('x_t',v);
        if(f){this.hi=[v];this.idx=0;return}
        if(this.idx>-1&&this.hi[this.idx]===v)return;
        this.hi=this.hi.slice(0,this.idx+1);this.hi.push(v);
        if(this.hi.length>60)this.hi.shift();else this.idx++;
    }
    cmd(c){
        if(c=='cp'){navigator.clipboard.writeText(this.el.value.substring(this.el.selectionStart,this.el.selectionEnd)||this.el.value);this.to('已复制')}
        if(c=='ps'){navigator.clipboard.readText().then(t=>{const s=this.el.selectionStart;this.el.value=this.el.value.slice(0,s)+t+this.el.value.slice(this.el.selectionEnd);this.sv();this.up()})}
        if(c=='un'&&this.idx>0){this.el.value=this.hi[--this.idx];this.up()}
        if(c=='re'&&this.idx<this.hi.length-1){this.el.value=this.hi[++this.idx];this.up()}
        if(c=='ml'||c=='mr'){let p=this.el.selectionStart;p=c=='ml'?p-1:p+1;this.el.setSelectionRange(p,p);this.el.focus()}
    }
    act(a){
        let v=this.el.value;
        if(a=='fm')v=v.replace(/[ \t]+/g,' ').replace(/^ +| +$/gm,'').replace(/[\r\n]{2,}/g,'\n').replace(/([\u4e00-\u9fa5])([a-z0-9])/gi,'$1 $2').replace(/([a-z0-9])([\u4e00-\u9fa5])/gi,'$1 $2');
        if(a=='dd')v=[...new Set(v.split('\n'))].join('\n');
        if(a=='mg')v=v.replace(/[\r\n]+/g,'');
        if(a=='ln')v=v.split('\n').map((x,i)=>`${i+1}. ${x.replace(/^\d+\.\s*/,'')}`).join('\n');
        if(a=='cc')v=(v===v.toUpperCase())?v.toLowerCase():v.toUpperCase();
        if(a=='rv')v=v.split('').reverse().join('');
        if(a=='sr')v=v.split('\n').sort((x,y)=>x.localeCompare(y,'zh')).join('\n');
        if(a=='et'){
            const r={'时':/(\d{4}[-/年]\d{1,2}[-/月]\d{1,2}日?)|(\d{1,2}:\d{1,2})/g,'机':/1[3-9]\d{9}/g,'邮':/[\w.-]+@[\w.-]+\.[a-z]{2,}/gi};
            let o=[];for(let k in r){let m=v.match(r[k]);if(m)o.push(`【${k}】\n${[...new Set(m)].join('\n')}`)}
            v=o.length?o.join('\n\n'):v;
        }
        if(a=='tb')return this.makeTab();
        if(a=='ex')return this.mod('导出','<div class="gr" style="padding:20px"><button class="tb" onclick="e.doEx(\'doc\')">DOC</button><button class="tb" onclick="e.doEx(\'txt\')">TXT</button><button class="tb" onclick="e.doEx(\'html\')">HTML</button></div>');
        this.el.value=v;this.sv();this.up();
    }
    find(d){
        const q=document.getElementById('fi').value;if(!q)return;
        const v=this.el.value;let i=d>0?v.indexOf(q,this.el.selectionEnd):v.lastIndexOf(q,this.el.selectionStart-1);
        if(i<0)i=d>0?v.indexOf(q):v.lastIndexOf(q);
        if(i>-1){this.el.setSelectionRange(i,i+q.length);this.el.focus()}
    }
    rep(a){
        const f=document.getElementById('fi').value,r=document.getElementById('ri').value;
        if(a)this.el.value=this.el.value.split(f).join(r);
        else if(this.el.value.substring(this.el.selectionStart,this.el.selectionEnd)===f)this.el.setRangeText(r);
        this.sv();this.up();
    }
    makeTab(){
        const rs=this.el.value.trim().split('\n').map(x=>x.split(/\s+/));
        let h='<table class="p-tab">';rs.forEach(r=>h+=`<tr>${r.map(c=>`<td>${c}</td>`).join('')}</tr>`);
        document.getElementById('tc').innerHTML=h+'</table>';
        document.getElementById('tp').style.display='flex';
        document.getElementById('s-ti').onclick=()=>html2canvas(document.querySelector('.p-tab'),{backgroundColor:'#000'}).then(c=>this.dl(c.toDataURL(),'tab.png'));
        document.getElementById('s-th').onclick=()=>this.df(document.getElementById('tc').innerHTML,'tab.html','text/html');
    }
    doEx(t){
        const v=this.el.value;let c=v,m='text/plain';
        if(t=='doc'){c=`<html><body>${v.replace(/\n/g,'<br>')}</body></html>`;m='application/msword'}
        if(t=='html'){c=`<html><body><pre>${v}</pre></body></html>`;m='text/html'}
        this.df(c,`ex.${t}`,m);
    }
    mod(t,h){const w=document.getElementById('mw');document.getElementById('mt').innerText=t;document.getElementById('m-body').innerHTML=h;w.style.display='flex'}
    ss(){this.to('生成中');html2canvas(document.body,{backgroundColor:'#000'}).then(c=>this.dl(c.toDataURL(),'s.png'))}
    to(m){const t=document.getElementById('toast');t.innerText=m;t.classList.add('on');setTimeout(()=>t.classList.remove('on'),1500)}
    df(c,n,m){const b=new Blob([c],{type:m}),u=URL.createObjectURL(b);this.dl(u,n)}
    dl(u,n){const a=document.createElement('a');a.href=u;a.download=n;a.click()}
}
const e=new Editor();
</script>
</body>
</html>
