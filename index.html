<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no,viewport-fit=cover">
<title>ÊñáÊú¨ÁºñËæëÂô® 2558/Âæê</title>
<script src="https://cdn.bootcdn.net/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{--bg:#000;--sf:rgba(28,28,30,0.85);--tx:#fff;--sub:#86868b;--bd:rgba(255,255,255,0.12);--ac:#0a84ff;--er:#ff453a;--default-font-size:17px}
*{box-sizing:border-box;outline:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--tx);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;display:flex;flex-direction:column;overflow:hidden;padding-bottom:calc(60px + env(safe-area-inset-bottom))}
.header{height:50px;display:flex;justify-content:space-between;align-items:center;padding:0 16px;background:var(--sf);border-bottom:0.5px solid var(--bd);backdrop-filter:blur(20px);z-index:50;flex-shrink:0}
.hl,.hr{display:flex;align-items:center;gap:10px}
.dots{display:flex;gap:8px}
.dot{width:12px;height:12px;border-radius:50%}
.dot.r{background:#ff5f57}.dot.y{background:#febc2e}.dot.g{background:#28c840;cursor:pointer}
.brand{font-size:13px;font-weight:600;color:var(--tx);letter-spacing:0.5px;margin-left:5px}
.st{font-size:12px;color:var(--sub);font-variant-numeric:tabular-nums;display:none}
.bt{padding:6px 12px;color:var(--sub);border-radius:6px;font-size:13px;background:rgba(255,255,255,0.08);cursor:pointer;white-space:nowrap;transition:.2s}
.bt:hover{background:rgba(255,255,255,0.15);color:#fff}
.bt.er{color:var(--er)}
.bt.ac{color:var(--ac)}
.main{flex:1;position:relative;overflow-y:auto;overflow-x:hidden;display:flex;flex-direction:column}
.main::-webkit-scrollbar{width:6px;height:6px}
.main::-webkit-scrollbar-thumb{background:rgba(255,255,255,0.2);border-radius:3px}
.gl{position:absolute;inset:0;pointer-events:none;opacity:0;background-size:24px 24px;background-image:linear-gradient(to right,#222 1px,transparent 1px),linear-gradient(to bottom,#222 1px,transparent 1px);z-index:0;transition:opacity .3s}
.cr{position:fixed;background:var(--er);opacity:0;pointer-events:none;z-index:2;transition:opacity .3s}
.cr.x{top:50%;left:0;width:100%;height:1px;box-shadow:0 0 4px rgba(255,0,0,0.5)}
.cr.y{left:50%;top:0;height:100%;width:1px;box-shadow:0 0 4px rgba(255,0,0,0.5)}
#ed{width:100%;flex:1;font-size:var(--default-font-size);line-height:1.75;padding:20px;resize:none;display:block;border:0;background:0 0;color:inherit;caret-color:var(--ac);z-index:1;min-height:calc(100vh - 50px - 60px - env(safe-area-inset-bottom))}
.dock{background:var(--sf);border-top:0.5px solid var(--bd);backdrop-filter:blur(25px);padding-bottom:env(safe-area-inset-bottom);z-index:50;width:100%;position:fixed;left:0;right:0;bottom:0}
.pl{height:0;overflow:hidden;transition:height .3s cubic-bezier(0.16,1,0.3,1);background:rgba(0,0,0,0.5)}
.pl.on{height:auto;max-height:50vh;overflow-y:auto;border-bottom:0.5px solid var(--bd)}
.pc{padding:12px 16px;display:flex;flex-direction:column;gap:14px;width:100%;max-width:960px;margin:0 auto}
.rw{display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap}
.ig{background:rgba(255,255,255,0.05);border:0.5px solid var(--bd);border-radius:8px;display:flex;flex:1;padding:2px}
.ig input{flex:1;padding:0 8px;font-size:14px;height:32px;background:0 0;border:0;color:#fff}
.ig button{width:32px;background:0 0;border:0;border-left:0.5px solid var(--bd);color:var(--sub);cursor:pointer}
.ig button:hover{color:#fff}
.gr{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.tb{background:rgba(255,255,255,0.08);color:#ccc;border:0;padding:12px 0;border-radius:10px;font-size:13px;cursor:pointer}
.tb:hover{background:rgba(255,255,255,0.12)}
.tb.w{background:rgba(255,255,255,0.08);color:#ccc;font-weight:500;grid-column:span 1}
.bar{height:60px;display:flex;align-items:center;padding:0 10px;gap:8px;width:100%;max-width:1000px;margin:0 auto;justify-content:space-between;overflow-x:auto}
.ic{flex:1;height:42px;background:rgba(255,255,255,0.08);color:#fff;border-radius:10px;border:0;font-size:18px;cursor:pointer;transition:.2s;min-width:44px}
.ic:active{transform:scale(0.95)}
.ic:hover{background:rgba(255,255,255,0.15)}
.ic.m{background:rgba(10,132,255,0.2);color:var(--ac);flex:0 0 50px}
.mo{position:fixed;inset:0;background:rgba(0,0,0,0.6);backdrop-filter:blur(10px);z-index:100;display:none;align-items:center;justify-content:center}
.mb{background:#1c1c1e;width:90%;max-width:380px;border-radius:16px;border:0.5px solid var(--bd);overflow:hidden;box-shadow:0 20px 40px rgba(0,0,0,0.5)}
.mh{padding:16px;border-bottom:0.5px solid var(--bd);display:flex;justify-content:space-between;font-weight:600}
.ts{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(30,30,30,0.9);padding:14px 24px;border-radius:40px;color:#fff;opacity:0;pointer-events:none;transition:all .2s;z-index:200;border:0.5px solid var(--bd);backdrop-filter:blur(10px)}
.ts.on{opacity:1;transform:translate(-50%,-50%) scale(1.05)}
#tp{position:fixed;inset:0;background:#000;z-index:150;display:none;flex-direction:column}
.ph{padding:16px;display:flex;justify-content:flex-end;gap:10px;border-bottom:1px solid #333;background:var(--sf)}
.p-cnt{flex:1;overflow:auto;padding:30px;display:flex;justify-content:center}
.p-tab{border-collapse:collapse;color:#fff;width:100%;max-width:900px}
.p-tab td{border:1px solid #444;padding:12px;font-size:14px}
.p-tab tr:nth-child(even){background:#111}
.show-grid .gl{opacity:1}
.show-grid .cr{opacity:1}

@media(min-width:768px){
.st{display:block}
#ed{padding:30px 10%;max-width:1400px;margin:0 auto}
}

@media (max-width:480px){
.gr{grid-template-columns:repeat(2,1fr)}
.header{padding:0 8px}
.bt{padding:6px 8px;font-size:12px}
.ic{font-size:16px}
.pc{padding:10px}
.rw{gap:8px}
.ig input{font-size:13px}
.tb{padding:10px 0;font-size:12px}
}
</style>
</head>
<body>
<div class="header">
    <div class="hl">
        <div class="dots"><div class="dot r"></div><div class="dot y"></div><div class="dot g" id="b-dg" title="Êà™Âõæ"></div></div>
        <div class="brand"> ÊñáÊú¨ÁºñËæëÂô® 2558/Âæê</div>
        <div id="st" class="st" style="margin-left:15px"></div>
    </div>
    <div class="hr">
        <div class="bt ac" id="b-ss">Êà™Âõæ</div>
        <div class="bt" id="b-py">ËµûÂä©</div>
        <div class="bt er" id="b-cl">Ê∏ÖÁ©∫</div>
    </div>
</div>

<div class="main">
    <div id="gl" class="gl"></div>
    <div class="cr x"></div><div class="cr y"></div>
    <textarea id="ed" placeholder="ËØ∑ËæìÂÖ•ÂÜÖÂÆπ" spellcheck="false"></textarea>
</div>

<div class="dock">
    <div class="pl on" id="pl">
        <div class="pc">
            <div class="rw">
                <span style="font-size:13px;color:var(--sub)">Â≠óÂè∑</span>
                <input type="range" id="fs" min="12" max="48" value="17">
                <button class="tb" style="width:70px" id="b-tg">ÂèÇËÄÉ</button>
            </div>

            <div class="rw">
                <div class="ig"><input id="fi" placeholder="Êü•Êâæ"><button id="f-n">‚Üì</button><button id="f-p">‚Üë</button></div>
                <div class="ig"><input id="ri" placeholder="ÊõøÊç¢"><button id="r-o">Êç¢</button><button id="r-a">ÂÖ®</button></div>
            </div>

            <div class="gr">
                <button class="tb" data-a="fm">ÊéíÁâà</button>
                <button class="tb" data-a="dd">ÂéªÈáç</button>
                <button class="tb" data-a="mg">ÂêàÂπ∂</button>
                <button class="tb" data-a="ln">Ë°åÂè∑</button>

                <button class="tb" data-a="cc">Aa</button>
                <button class="tb" data-a="rv">ÁøªËΩ¨</button>
                <button class="tb" data-a="sr">ÊéíÂ∫è</button>
                <button class="tb" data-a="et">ÊèêÂèñ</button>

                <button class="tb w" data-a="tb">Âà∂Ë°®</button>
                <button class="tb w" data-a="ex">ÂØºÂá∫</button>
            </div>
        </div>
    </div>

    <div class="bar">
        <button class="ic" data-c="cp">C</button>
        <button class="ic" data-c="ml">‚Üê</button>
        <button class="ic" data-c="mr">‚Üí</button>
        <button class="ic" data-c="un">‚Ü∂</button>
        <button class="ic" data-c="re">‚Ü∑</button>
        <button class="ic" data-c="ps">V</button>
        <button class="ic m" id="b-m">‚ñº</button>
    </div>
</div>

<div class="mo" id="mw">
    <div class="mb">
        <div class="mh"><span id="mt"></span><span style="cursor:pointer" id="mc">‚úï</span></div>
        <div id="m-body"></div>
    </div>
</div>

<div id="tp">
    <div class="ph"><button class="bt" id="s-ti">Â≠òÂõæ</button><button class="bt" id="s-th">ÁΩëÈ°µ</button><button class="bt er" id="c-tp">ÂÖ≥Èó≠</button></div>
    <div class="p-cnt" id="tc"></div>
</div>

<div id="toast" class="ts"></div>

<script>
class Editor{
    constructor(){
        this.el=document.getElementById('ed');
        this.st=document.getElementById('st');
        this.hi=[];this.idx=-1;this.ti=null;
        this.init();
    }

    init(){
        this.el.value=localStorage.getItem('x_t')||'';
        const sz=localStorage.getItem('x_s')||'17';
        document.documentElement.style.setProperty('--default-font-size', sz+'px');
        this.el.style.fontSize=sz+'px';
        document.getElementById('fs').value=sz;
        this.up();this.sv(true);this.bind();
        if(!localStorage.getItem('x_pl_state')) document.getElementById('pl').classList.add('on');
    }

    bind(){
        this.el.oninput=()=>{this.up();this.resize();clearTimeout(this.ti);this.ti=setTimeout(()=>this.sv(),500)};
        document.getElementById('b-cl').onclick=()=>{if(confirm('Ê∏ÖÁ©∫ÂÖ®ÈÉ®Ôºü')){this.el.value='';this.sv();this.up();this.resize()}};
        document.getElementById('b-dg').onclick=()=>this.ss();
        document.getElementById('b-ss').onclick=()=>this.ss();
        document.getElementById('b-py').onclick=()=>this.mod('ËµûÂä©','<div style="padding:30px;text-align:center"><img src="1000003802.png" style="max-width:100%;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,0.5)"></div>');
        document.getElementById('b-m').onclick=()=>{
            document.getElementById('pl').classList.toggle('on');
            localStorage.setItem('x_pl_state', document.getElementById('pl').classList.contains('on')? 'on' : 'off');
        };

        document.getElementById('fs').oninput=(e)=>{
            this.el.style.fontSize=e.target.value+'px';
            document.documentElement.style.setProperty('--default-font-size', e.target.value+'px');
            localStorage.setItem('x_s',e.target.value);
            this.resize();
        };

        document.getElementById('b-tg').onclick=()=>document.body.classList.toggle('show-grid');
        document.getElementById('f-n').onclick=()=>this.find(1);
        document.getElementById('f-p').onclick=()=>this.find(-1);
        document.getElementById('r-o').onclick=()=>this.rep(0);
        document.getElementById('r-a').onclick=()=>this.rep(1);
        document.querySelector('.gr').onclick=(e)=>{const a=e.target.dataset.a;if(a)this.act(a)};
        document.querySelector('.bar').onclick=(e)=>{const c=e.target.dataset.c;if(c)this.cmd(c)};
        document.getElementById('mc').onclick=()=>document.getElementById('mw').style.display='none';
        document.getElementById('c-tp').onclick=()=>document.getElementById('tp').style.display='none';
    }

    up(){const v=this.el.value;this.st.innerText=`${v.length}Â≠ó / ${v?v.split('\n').length:1}Ë°å`}

    sv(f){
        const v=this.el.value;localStorage.setItem('x_t',v);
        if(f){this.hi=[v];this.idx=0;return}
        if(this.idx>-1&&this.hi[this.idx]===v)return;
        this.hi=this.hi.slice(0,this.idx+1);this.hi.push(v);
        if(this.hi.length>60)this.hi.shift();else this.idx++;
    }

    resize(){
        this.el.style.height='auto';
        this.el.style.height=this.el.scrollHeight+'px';
    }

    cmd(c){

        if(c=='cp'){
            navigator.clipboard.writeText(
                this.el.value.substring(this.el.selectionStart,this.el.selectionEnd)||this.el.value
            );
            this.to('Â∑≤Â§çÂà∂')
        }

        if(c=='ps'){
            navigator.clipboard.readText().then(t=>{
                const s=this.el.selectionStart;
                this.el.value=this.el.value.slice(0,s)+t+this.el.value.slice(this.el.selectionEnd);
                this.sv();this.up();this.resize()
            })
        }

        if(c=='un'&&this.idx>0){
            this.el.value=this.hi[--this.idx];this.up();this.resize()
        }

        if(c=='re'&&this.idx<this.hi.length-1){
            this.el.value=this.hi[++this.idx];this.up();this.resize()
        }

        /* üåü Êô∫ËÉΩË∑≥Ë∑ÉÂÖâÊ†á */
        if(c=='ml'||c=='mr'){
            const v=this.el.value;
            let p=this.el.selectionStart;
            const len=v.length;

            if(c=='ml'){
                if(p>0){
                    if(/\s/.test(v[p-1])){
                        while(p>0 && /\s/.test(v[p-1])) p--;
                    }else{
                        while(p>0 && !/\s/.test(v[p-1])) p--;
                    }
                }
            }else{
                if(p<len){
                    if(/\s/.test(v[p])){
                        while(p<len && /\s/.test(v[p])) p++;
                    }else{
                        while(p<len && !/\s/.test(v[p])) p++;
                    }
                }
            }

            this.el.setSelectionRange(p,p);
            this.el.focus();
        }

    }

    act(a){
        let v=this.el.value;
        if(a=='fm')v=v.replace(/[ \t]+/g,' ').replace(/^ +| +$/gm,'').replace(/[\r\n]{2,}/g,'\n').replace(/([\u4e00-\u9fa5])([a-z0-9])/gi,'$1 $2').replace(/([a-z0-9])([\u4e00-\u9fa5])/gi,'$1 $2');
        if(a=='dd')v=[...new Set(v.split('\n'))].join('\n');
        if(a=='mg')v=v.replace(/[\r\n]+/g,'');
        if(a=='ln')v=v.split('\n').map((x,i)=>`${i+1}. ${x.replace(/^\d+\.\s*/,'')}`).join('\n');
        if(a=='cc')v=(v===v.toUpperCase())?v.toLowerCase():v.toUpperCase();
        if(a=='rv')v=v.split('').reverse().join('');
        if(a=='sr')v=v.split('\n').sort((x,y)=>x.localeCompare(y,'zh')).join('\n');

        if(a=='et'){
            const r={'Êó∂Èó¥':/(\d{4}[-/Âπ¥]\d{1,2}[-/Êúà]\d{1,2}Êó•?)|(\d{1,2}:\d{1,2})/g,'ÁîµËØù':/1[3-9]\d{9}/g,'ÈÇÆÁÆ±':/[\w.-]+@[\w.-]+\.[a-z]{2,}/gi};
            let o=[];
            for(let k in r){
                let m=v.match(r[k]);
                if(m)o.push(`„Äê${k}„Äë\n${[...new Set(m)].join('\n')}`)
            }
            v=o.length?o.join('\n\n'):v;
        }

        if(a=='tb')return this.makeTab();
        if(a=='ex')return this.mod('ÂØºÂá∫','<div class="gr" style="padding:20px"><button class="tb" onclick="e.doEx(\'doc\')">DOC</button><button class="tb" onclick="e.doEx(\'txt\')">TXT</button><button class="tb" onclick="e.doEx(\'html\')">HTML</button></div>');

        this.el.value=v;
        this.sv();this.up();this.resize();
    }

    find(d){
        const q=document.getElementById('fi').value;if(!q)return;
        const v=this.el.value;
        let i=d>0?v.indexOf(q,this.el.selectionEnd):v.lastIndexOf(q,this.el.selectionStart-1);
        if(i<0)i=d>0?v.indexOf(q):v.lastIndexOf(q);
        if(i>-1){this.el.setSelectionRange(i,i+q.length);this.el.focus();this.el.blur();this.el.focus()}
    }

    rep(a){
        const f=document.getElementById('fi').value,r=document.getElementById('ri').value;
        if(a)this.el.value=this.el.value.split(f).join(r);
        else if(this.el.value.substring(this.el.selectionStart,this.el.selectionEnd)===f)this.el.setRangeText(r);
        this.sv();this.up();this.resize();
    }

    makeTab(){
        const rs=this.el.value.trim().split('\n').map(x=>x.split(/\s+/));
        let h='<table class="p-tab">';
        rs.forEach(r=>h+=`<tr>${r.map(c=>`<td>${c}</td>`).join('')}</tr>`);
        document.getElementById('tc').innerHTML=h+'</table>';
        document.getElementById('tp').style.display='flex';
        document.getElementById('s-ti').onclick=()=>html2canvas(document.querySelector('.p-tab'),{backgroundColor:'#000'}).then(c=>this.dl(c.toDataURL(),'table.png'));
        document.getElementById('s-th').onclick=()=>this.df(document.getElementById('tc').innerHTML,'table.html','text/html');
    }

    doEx(t){
        const v=this.el.value;let c=v,m='text/plain';
        if(t=='doc'){c=`<html><body>${v.replace(/\n/g,'<br>')}</body></html>`;m='application/msword'}
        if(t=='html'){c=`<html><body><pre>${v}</pre></body></html>`;m='text/html'}
        this.df(c,`export.${t}`,m);
    }

    mod(t,h){
        const w=document.getElementById('mw');
        document.getElementById('mt').innerText=t;
        document.getElementById('m-body').innerHTML=h;
        w.style.display='flex'
    }

    ss(){
        this.to('ÁîüÊàêÈïøÂõæ...');
        const d=document.querySelector('.main');
        const s=d.scrollTop;
        const h=this.el.scrollHeight;
        const o=d.style.overflow;
        d.style.overflow='visible'; 
        this.el.style.height=h+'px';

        html2canvas(d,{backgroundColor:'#000',height:h,windowHeight:h,y:0,useCORS:true})
        .then(c=>{
            this.dl(c.toDataURL(),'screenshot.png');
            d.style.overflow=o;d.scrollTop=s;
        })
        .catch(()=>{
            d.style.overflow=o;
            this.to('ÁîüÊàêÂ§±Ë¥•')
        });
    }

    to(m){
        const t=document.getElementById('toast');
        t.innerText=m;
        t.classList.add('on');
        setTimeout(()=>t.classList.remove('on'),2000)
    }

    df(c,n,m){
        const b=new Blob([c],{type:m}),u=URL.createObjectURL(b);
        this.dl(u,n)
    }

    dl(u,n){
        const a=document.createElement('a');
        a.href=u;
        a.download=n;
        a.click()
    }
}
const e=new Editor();
</script>
</body>
</html>
